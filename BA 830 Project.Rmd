---
title: "Lab Notebook"
author: "Your Name"
output:
  pdf_document: default
  html_document: default
---
```{r setup, include=FALSE}
## Please do not change this
knitr::opts_chunk$set(echo = TRUE)
```


```{r, warning = FALSE, echo = FALSE, message=FALSE}
## Read the data and create the variables, please don't modify this!

## Load library 'data.table'
library(data.table)
library(ggplot2)
library(tidyverse)
library(pwr)
library(fixest)
library(modelsummary)
## Read the data
wfh_data <- fread('wfh_small_heterog.csv')
dates_exp <- wfh_data[experiment_treatment == 1, unique(year_week)]
dates_preexp <- wfh_data[experiment_treatment == 0 & expgroup == 1, unique(year_week)]
# mean_productivity <- wfh_data[year_week %in% dates_preexp, list(pre_prod = mean(logcall_dayworked, na.rm = T)), by = list(personid)]

wfh_data <- wfh_data[year_week %in% dates_exp]
#wfh_data[, expgroup := NULL]
#wfh_data <- merge(wfh_data, mean_productivity, by = 'personid', all.x = T)
#wfh_data[is.nan(pre_prod), pre_prod := 0]
```

## a: Estimate the ATE of experiment_treatment on perform1 using regression. Provide a 95% confidence interval and p-value. In words, what is the effect?

```{r}
```

## b: Notice that in this dataset, there are many observations per worker. Each observation is a week. What type of randomization is this?

multiple obs per person-- its a cluster randomization

## c: To calculate correct standard errors, we must adjust them for this fact using the felm function below. Please use the felm function to do so and report the standard error. Does it rise or fall? 
```{r}
### Here is an example of the felm function that accounts for the fact that treatment is assigned by personid. Note that the variable 'personid' goes after the three '|' in the formula. Change the function below to compute the ATE.
this_reg <- feols(age ~ tenure, data = wfh_data, cluster = 'personid')
this_reg_noclu_se <- feols(age ~ tenure, data = wfh_data)

etable(this_reg, this_reg_noclu_se)
```

## d: Perform one variable with which to perform a randomization check and conduct it. Do you reject the null hypothesis of proper randomization? 

## e: You can measure preformance using the 'perform1' variable. You also observe many characteristics about workers. Which variable do you think will moderate the effect of the WFH policy? Which outcome will it affect? What direction and how big do you think the effect will be? Write this down now, so you can commit to this story. 

## f: Test the story you proposed in the data on the outcome and covariate which you proposed. Is there a statistically significant interaction? What is the size of the effect for the group? Hint: you can interact the treatment variable with the covariate your proposed.
```{r}
# Here is an example of how to interact variables. 
# This is a regression of age on: tenure, commute, married, men, tenure*commute, and married*men.
this_reg <- feols(age ~ tenure*commute +  married*men, data = wfh_data, cluster = 'person_id')
```

## How long did this assignment take you to do (hours)? How hard was it (easy, moderate, hard, too hard)?  







